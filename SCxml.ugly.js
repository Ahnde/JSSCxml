function XHR(target,caller,callback,postData,onerror){with(this.target=target,this.callback=callback,this.caller=caller,this.onerror=onerror,this.req=new XMLHttpRequest)open(postData?"POST":"GET",target,!0),onreadystatechange=XHR.handler(this),overrideMimeType("application/scxml+xml"),send(postData||null)}function Set(){this.items={},this.length=0,arguments.length&&this.add.apply(this,arguments)}function CompiledPath(t){this.parent=t[0].parentNode,this.path=t,this.end=t[t.length-1],this.atomic="parallel"!=this.end.tagName}function CompiledTree(t,e){this.parallels={},t.atomic||(this.parallels[t.end.getAttribute("id")]=this),this.root=t,this.children=[]}function Timeout(t,e,i){this.executed=!1,this.time=t[1],this.f=t[0],this.args=[],this.sc=i;for(var n=2;t[n];n++)this.args.push(t[n]);e?this.start():this.sc.timeouts.push(this)}function SCxml(t,e,i,n){if(this.dom=null,this.interpretASAP=n,this.autoPauseBefore=SCxml.NO_PAUSE,this.nextPauseBefore=SCxml.NO_PAUSE,this.internalQueue=[],this.externalQueue=[],this.configuration={},this.statesToEnter=null,this.invoked={},this.toInvoke=new Set,this.lastEvent=void 0,this.sid=SCxml.sessions.length,SCxml.sessions.push(this),this.html=e&&e instanceof Element?e:document.head.appendChild(document.createElement("scxml")),this.html.interpreter=this,this.delays={},this.timeouts=[],this.intervals=[],this.initIframe(i),this.running=!1,this.stable=!1,this.paused=!1,this.readyState=SCxml.LOADING,this.name="session "+this.sid,t instanceof Document)setTimeout(function(t,e){t.interpret(e)},0,this,t);else if(/^\s*</.test(t)){var r=(new DOMParser).parseFromString(t,"application/scxml+xml");setTimeout(function(t,e){t.interpret(e)},0,this,r)}else this.name=t.match(/[^\/]+\.(?:sc)?xml/)[0],new XHR(t,this,this.xhrResponse,null,this.xhrFailed)}function getId(t){return t.getAttribute("id")}with(XHR.handler=function(t){function e(){if(!(4>t.req.readyState))if(200==t.req.status)t.callback.call(t.caller,t);else{if(!t.onerror)throw"HTTP error "+t.req.status+" : "+t.req.statusText;t.onerror.call(t.caller,t)}}return e},Set.prototype.add=function(){for(var t=0;arguments.length>t;t++){var e=arguments[t];e in this.items||(this.items[e]=!0,this.length++)}return this.length},Set.prototype.remove=function(){for(var t=0;arguments.length>t;t++){var e=arguments[t];e in this.items&&(delete this.items[e],this.length--)}return this.length},CompiledPath.prototype.toString=function(){return this.path.map(function(t){return t.getAttribute("id")}).join(" → ")+(this.atomic?"":" ⇉ ")},CompiledTree.prototype.toString=function(){return this.root+(this.root.atomic?"":"("+this.children.join(" ∥ ")+")")},CompiledTree.prototype.appendChild=function(t){for(var e in t.parallels)this.parallels[e]=t.parallels[e];this.children.push(t)},CompiledTree.prototype.attach=function(t){var e;if(!((e=t.root.parent.getAttribute("id"))in this.parallels))return!1;for(var i=this.parallels[e].children,n=0,r;r=i[n];n++)if(r.root.path[0]==t.root.path[0]){for(e in r.parallels)delete this.parallels[e];break}for(e in t.parallels)this.parallels[e]=t.parallels[e];return i[n]=t,!0},CompiledTree.prototype.inEntryOrder=function(){return this.root.path.concat(this.root.atomic?[]:this.children.map(function(t){return t.inEntryOrder()}).reduce(function(t,e){return t.concat(e)})).filter(function(t){return!t.CA})},CompiledTree.prototype.atoms=function(){return this.root.atomic?[this.root.end]:this.children.map(function(t){return t.atoms()}).reduce(function(t,e){return t.concat(e)})},CompiledTree.prototype.select=function(t){var e=[],i=!0,n=!1;if(this.root.atomic)i=!1;else for(var r,a=0;this.children.length>a;a++)r=this.children[a].select(t),r.enabled.length?(e=e.concat(r.enabled),n|=r.hasTargets):i=!1;if(!i)for(var s,o=this.root.path,a=o.length-1;a>=0;a--)if(s=t(o[a])){if(s.targets){if(n)break;e.push(s),n=!0}else e.push(s);break}return{hasTargets:n,enabled:e}},Timeout.timesUp=function(t){t.timesUp()},Timeout.prototype.start=function(){this.timer||this.executed||(this.timer=setTimeout(this.time,Timeout.timesUp,this),this.started=+new Date)},Timeout.prototype.cancel=function(){this.timer&&!this.executed&&(clearTimeout(this.timer),delete this.timer)},Timeout.prototype.stop=function(){return this.timer&&!this.executed&&this.sc.running?(this.time-=new Date-this.started,15>this.time?!1:(clearTimeout(this.timer),delete this.timer,this.sc.timeouts.push(this),!0)):!1},Timeout.prototype.timesUp=function(){this.executed=!0;try{"function"==typeof this.f?sc.datamodel.call(f,this.args):sc.datamodel.expr(f,f)}catch(t){}},SCxml.sessions=[null],SCxml.parseSCXMLTags=function(){for(var t=document.getElementsByTagName("scxml"),e=0;t.length>e;e++)t[e].interpreter=new SCxml(t[e].getAttribute("src"),t[e],null,!0)},SCxml.prototype={timeout:function(t){return new Timeout(t,!this.paused)},interval:function(t){return new Interval(t,!this.paused)},clean:function(){this.readyState==SCxml.RUNNING&&this.terminate(),delete this.html.interpreter,this.html&&"scxml"==this.html.tagName&&this.html.parentNode.removeChild(this.html),delete this.html,delete this.datamodel,document.body.removeChild(this._iframe_),delete this._iframe_,SCxml.sessions[this.sid]=null,this.parent&&delete this.parent,delete this.invoked},terminate:function(){if(!(this.readyState<SCxml.RUNNNIG)){for(var t=this.dom.createNodeIterator(this.dom.documentElement,NodeFilter.SHOW_ELEMENT,SCxml.activeStateFilter),e=[],i;i=t.nextNode();)e.push(i);e.reverse(),this.readyState<SCxml.FINISHED&&(this.sendNoMore=!0),this.html.dispatchEvent(new CustomEvent("exit",{detail:{list:e.filter(this.exitState,this).map(getId)}})),this.running=!1,this.readyState>=SCxml.FINISHED&&this.parent&&this.parent.fireEvent(new SCxml.ExternalEvent("done.invoke."+this.iid,"#_"+this.iid,"scxml",this.iid,this.donedata)),delete this.donedata,this.sendNoMore=!0,this.invokedReady()}},toString:function(){return"SCxml("+this.name+")"},constructor:SCxml,invokedReady:function(){this.parent&&(this.parent.invoked[this.iid]=this,this.iid in this.parent.toInvoke.items&&!this.parent.toInvoke.remove(this.iid)&&this.parent.mainEventLoop2())},xhrResponse:function(t){this.interpret(t.req.responseXML)},xhrFailed:function(t){this.invokedReady()},validate:function(){if(!this.dom)throw"Failed to load SCXML because of malformed XML.";with(this.dom.documentElement){if("scxml"!=tagName)throw this.dom.documentURI+" is not an SCXML document";if("http://www.w3.org/2005/07/scxml"!=namespaceURI&&console.warn(this.dom.documentURI+" is not a valid SCXML document (missing or incorrect xmlns)"),hasAttribute("datamodel")&&"ecmascript"!=getAttribute("datamodel"))throw"'"+getAttribute("datamodel")+"' datamodel in "+this.dom.documentURI+" is not supported by JSSCxml";hasAttribute("binding")&&"early"!=getAttribute("binding")&&"late"!=getAttribute("binding")&&console.warn("binding='"+getAttribute("binding")+"' in"+this.dom.documentURI+" is not valid"),this.lateBinding="late"==getAttribute("binding"),hasAttribute("name")&&(this.name=getAttribute("name"))}with(this.dom){for(var states=querySelectorAll("state, final, parallel, history"),i=0,state;state=states[i];i++)state.hasAttribute("id")||state.setAttribute("id",this.uniqId());for(var invs=querySelectorAll("invoke"),i=0,inv;inv=invs[i];i++)inv.hasAttribute("id")||inv.setAttribute("id",this.invokeId(inv.parentNode.getAttribute("id")));getElementById=function(t){return querySelector("state[id='"+t+"'], final[id='"+t+"'], history[id='"+t+"'], parallel[id='"+t+"']")}}},inInvoke:function(t){for(var e=t.parentElement;e!=this.dom.documentElement;e=e.parentElement)if("invoke"==e.tagName)return!0;return!1},uniqId:function(){var t;do t="__generated_id_"+Math.floor(1e6*Math.random());while(this.dom.getElementById(t));return t},invokeId:function(t){var e;do e=t+".inv"+Math.floor(1e6*Math.random());while(this.dom.querySelector("invoke[id='"+e+"']"));return e},getById:function(t){var e=this.dom.getElementById(t);if(!e)throw this.name+": transition target "+t+" not found";return e},interpret:function(t){this.dom=t;try{this.validate()}catch(e){throw this.invokedReady(),e}var i=t.querySelector("scxml > datamodel");if(i)try{this.execute(i)}catch(e){}if(this.sharedData)for(var n in this.sharedData)this.sharedData.hasOwnProperty(n)&&(n in this.datamodel._jsscxml_predefined_?this.datamodel._jsscxml_predefined_[n]=this.sharedData[n]:n in this.datamodel?this.datamodel[n]=this.sharedData[n]:delete this.sharedData[n]);for(i=t.querySelectorAll("scxml > script"),n=0;i.length>n;n++)if(!this.inInvoke(i[n]))try{this.wrapScript(i[n].textContent,i[n])}catch(e){}for(i=t.querySelectorAll("scxml > * datamodel"),n=0;i.length>n;n++)if(!this.inInvoke(i[n]))if(this.lateBinding)try{i[n].unbound=!0,this.declare(i[n])}catch(e){}else try{this.execute(i[n])}catch(e){}this.running=!0,this.readyState=SCxml.READY,this.html.dispatchEvent(new Event("ready")),this.interpretASAP&&this.start()},start:function(){if(this.readyState<SCxml.READY)throw this.name+" is not ready yet.";if(this.readyState>SCxml.READY)throw this.name+" has already started.";var t=this.firstState(this.dom.documentElement);if(!t)throw this.invokedReady(),this.name+" has no suitable initial state.";t instanceof Array?this.addStatesToEnter(t):this.addStatesToEnter([t]),this.readyState=SCxml.RUNNING,this.html.dispatchEvent(new CustomEvent("enter",{detail:{list:this.statesToEnter.inEntryOrder().filter(this.enterState,this).map(getId)}})),this.stable?this.terminate():this.mainEventLoop()},firstState:function(t){if("state"!=t.tagName&&"scxml"!=t.tagName)return null;var e,i;if(t.hasAttribute("initial")){if(i=t.getAttribute("initial").split(/\s+/).map(this.getById,this),1==i.length||"state"==t.tagName)return i[0]}else if(i=this.dom.querySelector("[id="+getId(t)+"] > initial")){for(var n=i.firstElementChild;n&&"transition"!=n.tagName;)n=n.nextElementSibling;if(!n)throw this.invokedReady(),this.name+": <initial> requires a <transition>.";t.executeAfterEntry=n,i=this.dom.getElementById(e=n.getAttribute("target"))}else for(i=t.firstElementChild;i&&!(i.tagName in SCxml.STATE_ELEMENTS);)i=i.nextElementSibling;return i},addStatesToEnter:function(t,e){for(var i=0,n;n=t[i];i++)if(n.CA=!1,"history"==n.tagName){var r;if("record"in n)r=n.record;else{for(var a=n.firstElementChild;a&&"transition"!=a.tagName;)a=a.nextElementSibling;if(!a)throw this.invokedReady(),this.name+": <history> requires a default <transition>.";n.parentNode.executeAfterEntry=a,r=a.getAttribute("target").split(/\s+/).map(this.getById,this)}this.addStatesToEnter(r,e)}else this.statesToEnter=this.walkToEnter(n,this.statesToEnter,e)},walkToEnter:function(t,e,i){var n=[],r=getId(t);n.push(t);for(var a=t,s=t;a=this.firstState(a);)n.push(a),a.CA=!1;for(;"state"==(s=s.parentNode).tagName&&s!=i;)n.unshift(s),s.CA=t.CA;if("state"==s.tagName){do n.unshift(s),s.CA=!0;while("state"==(s=s.parentNode).tagName);s.CA=!0}else s.CA=s==i;var o=new CompiledTree(new CompiledPath(n));if(!o.root.atomic)for(var l=o.root.end.firstElementChild;l;)l.tagName in SCxml.STATE_ELEMENTS&&(e&&e.root.path[0]==l?o.appendChild(e):t.CA||this.walkToEnter(l,o,i)),l=l.nextElementSibling;if(e&&e.attach(o))return e;for(;"scxml"!=o.root.parent.tagName;)o=this.walkToEnter(o.root.parent,o,i);return o},enterState:function(t){var e=getId(t);if(e in this.configuration)return delete t.executeAfterEntry,void 0;this.configuration[e]=t,t.setAttribute("active",!0);var i;if(this.lateBinding&&(i=this.dom.querySelector("[id="+e+"] > datamodel"))&&"unbound"in i){console.log("binding late"),delete i.unbound;try{this.execute(i)}catch(n){}}var r=this.dom.querySelectorAll("[id="+e+"] > onentry");t.executeAfterEntry&&(r[r.length]=t.executeAfterEntry,delete t.executeAfterEntry);for(var a=0;r[a];a++)try{this.execute(r[a])}catch(n){}if(t.fin=!0,"final"==t.tagName){var s=this.dom.querySelector("[id="+e+"] > donedata");return s&&(this.donedata={},this.readParams(s,this.donedata),s=this.dom.querySelector("[id='"+e+"'] > donedata > content"),s&&(this.donedata=s.textContent)),this.finalState(t.parentNode)}return!0},finalState:function(t){if("scxml"==t.tagName)return this.running=!1,this.stable=!0,this.readyState=SCxml.FINISHED,this.html.dispatchEvent(new Event("finished")),!0;if("parallel"==t.tagName)for(var e=t.firstElementChild;e;e=e.nextElementSibling)if(e.tagName in SCxml.STATE_ELEMENTS&&!e.fin)return;t.fin=!0;var i=getId(t),n=new SCxml.Event("done.state."+i);return n.data=this.donedata,delete this.donedata,this.html.dispatchEvent(new CustomEvent("queue",{detail:n})),this.internalQueue.push(n),"parallel"==t.parentNode.tagName&&this.finalState(t.parentNode),!0},findLCCA:function(t){if(!t.lcca||t.hasAttribute("targetexpr")){var e=t.parentNode,i=t.targets;if(t.internal=!1,null==i)return t.lcca=null;t.lcca=e;var n=i.map(function(t){"history"==t.tagName&&(t=t.parentNode);var e=getId(t);return"state[id="+e+"], final[id="+e+"], history[id="+e+"], parallel[id="+e+"]"}).join(", ");if(e.querySelectorAll(n).length==i.length){if(t.internal="internal"==t.getAttribute("type"))return;for(;(t.lcca=t.lcca.parentNode).querySelectorAll(n).length<i.length;);}t.internal||t.lcca!=e||(t.lcca=t.lcca.parentNode);for(var r=0,a;a=i[r];r++)a==t.lcca&&(t.lcca=t.lcca.parentNode);for(;"parallel"==t.lcca.tagName;)t.lcca=t.lcca.parentNode}},saveHistory:function(t){var e=getId(t);if(e in this.configuration)for(var i=this.dom.querySelectorAll("[id="+e+"] > history"),n=0,r;r=i[n];n++)r.record=this.activeChildren(t,"deep"==r.getAttribute("type"))},exitState:function(t){var e=getId(t);if(e in this.configuration){t.removeAttribute("willExit");for(var i=this.dom.querySelectorAll("[id="+e+"] > onexit"),n=0;i.length>n;n++)try{this.execute(i[n])}catch(r){}var a=this.dom.querySelectorAll("[id="+e+"] > invoke");for(n=0;a.length>n;n++)this.cancelInvoke(getId(a[n]));return delete this.configuration[e],t.removeAttribute("active"),!0}},expr:function(t,e){return this.datamodel.expr(t,e)},log:function(t){console.log(t)},error:function(t,e,i,n){var r=new SCxml.Error("error."+t,e,i);throw this.html.dispatchEvent(new CustomEvent("queue",{detail:r})),this.internalQueue.push(r),n||console.error(i+"\nin SCXML "+this.name+" :",e),i},selectTransitions:function(t){function e(e){for(var n=e.firstElementChild;n;n=n.nextElementSibling)if(1==n.nodeType&&"transition"==n.tagName&&(t?n.hasAttribute("event")&&t.match(n):!n.hasAttribute("event"))){var r=!1;try{r=!n.hasAttribute("cond")||i.expr(n.getAttribute("cond"),n)}catch(a){}if(r){if(n.hasAttribute("targetexpr"))try{var s=String(i.expr(n.getAttribute("targetexpr"),n));n.targets=s?s.split(/\s+/).map(i.getById,i):null}catch(a){n.targets=null}else n.targets||(n.targets=n.hasAttribute("target")?n.getAttribute("target").split(/\s+/).map(i.getById,i):null);return n}}return!1}var i=this;return this.statesToEnter.select(e).enabled},mainEventLoop:function(){for(;this.running&&!this.stable;){if(this.macrostep(),!this.running)return this.terminate();if(this.invokeAll())return;if(this.stable=!0,this.extEventLoop(),!this.running)return this.terminate()}this.invokedReady()},mainEventLoop2:function(){return this.internalQueue.length?this.mainEventLoop():(this.stable=!0,this.extEventLoop(),this.running?(this.mainEventLoop(),void 0):this.terminate())},macrostep:function(){for(;this.running;){var t=this.selectTransitions(null);if(!t.length)for(var e;(e=this.internalQueue.shift())&&(this.html.dispatchEvent(new CustomEvent("consume",{detail:"internal"})),this.lastEvent=e,t=this.selectTransitions(e),!t.length););if(!t.length)break;this.takeTransitions(t)}},extEventLoop:function(){this.stable=!1;for(var t,e;t=this.externalQueue.shift();){if(this.lastEvent=t,t.invokeid&&t.invokeid in this.invoked){var i=this.dom.querySelector("[id='"+t.invokeid+"'] > finalize");i&&(i.firstElementChild?this.execute(i):this.emptyFinalize(t))}this.html.dispatchEvent(new CustomEvent("consume",{detail:"external"}));for(var n in this.invoked)this.invoked[n].af&&this.invoked[n].fireEvent(t);if(e=this.selectTransitions(t),e.length)return this.takeTransitions(e)}this.stable=!0,console.log(this.name+": waiting for external events."),this.html.dispatchEvent(new Event("waiting"))},takeTransitions:function(e){for(var i=0;t=e[i];i++)if(t.parentElement.getAttribute("willExit")&&t.targets)e.splice(i--,1);else if(console.log(this.name+": "+getId(t.parentNode)+" → "+(t.targets?"["+t.targets.map(getId)+"]":"*targetless*")),this.findLCCA(t),t.targets){var n=this.dom.createNodeIterator(t.lcca,NodeFilter.SHOW_ELEMENT,SCxml.activeStateFilter),r=n.nextNode();for(r&&r!=t.lcca&&r.setAttribute("willExit",!0);r=n.nextNode();)r.setAttribute("willExit",!0);n.detach()}var a=this.dom.querySelectorAll("[willExit]"),s=[];if(a.length){for(i=a.length-1;i>=0;i--)s.push(a[i]);s.forEach(this.saveHistory,this),this.html.dispatchEvent(new CustomEvent("exit",{detail:{list:s.filter(this.exitState,this).map(getId)}}))}for(i=0;t=e[i];i++)try{this.execute(t)}catch(o){}var l=this.statesToEnter;for(this.statesToEnter=null,i=0;t=e[i];i++)t.targets&&this.addStatesToEnter(t.targets,t.lcca);this.statesToEnter?this.html.dispatchEvent(new CustomEvent("enter",{detail:{list:this.statesToEnter.inEntryOrder().filter(this.enterState,this).map(getId)}})):this.statesToEnter=l},activeChildren:function(t,e){var i=[],n=this.dom.createTreeWalker(t||this.dom.documentElement,NodeFilter.SHOW_ELEMENT,SCxml.activeStateFilter);if(!n.firstChild())return i;for(;;){if(e)for(;n.firstChild(););if(i.push(n.currentNode),!(e?n.nextNode():n.nextSibling()))break}return i},onEvent:function(t){if(!this.running)return console.warn(this.name+" has terminated and cannot process more events"),void 0;if(t instanceof Event?t=SCxml.ExternalEvent.fromDOMEvent(t):"string"==typeof t&&(t=new SCxml.ExternalEvent(t,null,void 0,null,arguments[1])),this.html.dispatchEvent(new CustomEvent("queue",{detail:t})),this.externalQueue.push(t),this.stable&&!this.paused){if(this.extEventLoop(),!this.running)return this.terminate();this.stable||this.mainEventLoop()}}},SCxml.prototype.fireEvent=SCxml.prototype.onEvent,SCxml.NO_PAUSE=0,SCxml.EXT_EVENTS=1,SCxml.ALL_EVENTS=2,SCxml.LOADING=0,SCxml.READY=1,SCxml.RUNNING=2,SCxml.FINISHED=3,SCxml.STATE_ELEMENTS={state:"state",parallel:"parallel","final":"final"},SCxml.stateFilter={acceptNode:function(t){return 2-(t.tagName in SCxml.STATE_ELEMENTS)}},SCxml.tagNameFilter=function(t){return{acceptNode:function(e){return e.tagName==t?1:2}}},SCxml.activeStateFilter={acceptNode:function(t){return t.tagName in SCxml.STATE_ELEMENTS&&t.getAttribute("active")?1:2}},SCxml.EventProcessors={SCXML:{name:"http://www.w3.org/TR/scxml/#SCXMLEventProcessor",createEvent:function(t,e,i){return new SCxml.ExternalEvent(t,"#_scxml_"+e.sid,SCxml.EventProcessors.SCXML.name,void 0,i)},send:function(t,e,i,n){if(!n.sendNoMore){e=e||"#_scxml_"+n.sid,console.log("sending a "+t.name+" event to "+e);var r;(r=e.match(/^#_scxml_(.+)$/))&&(r=r[1])?r in SCxml.sessions&&SCxml.sessions[r]?SCxml.sessions[r].onEvent(t):n.error("communication",i,new Error('target session "'+e+'" does not exist')):e.match(/^#_parent$/)?n.parent?(t.invokeid=n.iid,n.parent.onEvent(t)):n.error("communication",i,new Error("this session has no #_parent")):(r=e.match(/^#_(.+)$/))&&(r=r[1])?r in n.invoked?n.invoked[r].onEvent(t):n.error("communication",i,new Error('invoked target "'+e+'" does not exist')):n.error("execution",i,new Error('unsupported target "'+e+'" for SCXML events'))}}},DOM:{name:"http://www.w3.org/TR/scxml/#DOMEventProcessor",createEvent:function(t,e,i){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!0,!1,i),n},send:function(t,e,i,n){if(!n.sendNoMore){var r;if(e||(r=n.html),!r)try{"/"==e[0]&&(r=document.evaluate(e,n.html,null,9,null).singleNodeValue),"#"==e[0]&&(r=document.querySelector(e))}catch(a){n.error("execution.DOM",i,a)}if(!r)try{r=document.evaluate(e,n.html,null,9,null).singleNodeValue}catch(a){}if(!r)try{r=document.querySelector(e)}catch(a){}r||n.error("execution.DOM",i,new Error('Failed to evaluate "'+e+'" to an existing element')),console.log("sending a "+t.type+" event to ",r),r.dispatchEvent(t)}}}},SCxml.prototype.initIframe=function(data){if(!this.datamodel){with(this._iframe_=document.createElement("iframe"))className="scxml_script_frame",style.display="none";with(document.body.appendChild(this._iframe_),this.datamodel=this._iframe_.contentWindow,this.datamodel.document)open(),write('<script>\nfunction expr(s,el)\n{\n	try{ with(_jsscxml_predefined_){ return eval(s) } }\n	catch(e){ _sc.error("execution",el,e) }\n}\nfunction call(f, args)\n{\n	try{ with(_jsscxml_predefined_){ return f.call(null, args) } }\n	catch(e){ _sc.error("execution",f,e) }\n}\n\n</script>\n');this.datamodel._sc=this,this.datamodel._jsscxml_predefined_={};for(var i in this.datamodel)this.datamodel.hasOwnProperty(i)&&(this.datamodel._jsscxml_predefined_[i]=void 0);if(this.datamodel.__defineGetter__("_sessionid",function(){return this._sc.sid}),this.datamodel.__defineSetter__("_sessionid",function(){return this._sc.sid}),this.datamodel.__defineGetter__("_event",function(){return this._sc.lastEvent}),this.datamodel.__defineSetter__("_event",function(){return this._sc.lastEvent}),this.datamodel.__defineGetter__("_name",function(){return this._sc.name}),this.datamodel.__defineSetter__("_name",function(){return this._sc.name}),this.datamodel.__defineGetter__("_ioprocessors",function(){return SCxml.EventProcessors}),this.datamodel.__defineSetter__("_ioprocessors",function(){return SCxml.EventProcessors}),this.datamodel._x={},data)for(i in data)data.hasOwnProperty(i)&&(this.datamodel.hasOwnProperty(i)?this.datamodel._jsscxml_predefined_[i]=data[i]:this.datamodel[i]=data[i]);this.datamodel.document.write("<script>\nfunction In(state){ return state in _sc.configuration }\nfunction setTimeout(){\n	return _sc.timeout(arguments)\n}\nfunction setInterval(){\n	return _sc.interval(arguments)\n}\nfunction clearTimeout(t){\n	return t.cancel()\n}\nfunction clearInterval(t){\n	return t.cancel()\n}\n</script>\n"),delete this.datamodel._jsscxml_predefined_.setTimeout,delete this.datamodel._jsscxml_predefined_.setInterval,delete this.datamodel._jsscxml_predefined_.clearTimeout,delete this.datamodel._jsscxml_predefined_.clearInterval}},SCxml.prototype.wrapScript=function(t,e){this.datamodel._element=e,this.datamodel.document.write("<script>\ntry{ with(_jsscxml_predefined_){\n"+t+'\n}} catch(err){_sc.error("execution", _element, err)}\n</script>')},SCxml.Event=function SCxmlEvent(t,e){this.name=t,this.timestamp=(new Date).getTime(),this.type=e||"platform"},SCxml.Event.prototype={constructor:SCxml.Event,toString:function(){return"SCxmlEvent("+this.name+")"},origin:void 0,origintype:void 0,sendid:void 0,invokeid:void 0,data:void 0,match:function(t){var e=t.getAttribute("event").split(/\s+/),i=this.name.split(".");t:for(var n=0,r;r=e[n];n++)if(!((r=r.split(".")).length>i.length)){for(var a=0;r.length>a;a++)if("*"!=r[a]&&r[a]!=i[a])continue t;return!0}return!1}},SCxml.InternalEvent=function(t,e){SCxml.Event.call(this,t,"internal"),this.srcElement=e||null},SCxml.InternalEvent.prototype=new SCxml.Event,SCxml.InternalEvent.prototype.constructor=SCxml.InternalEvent,SCxml.Error=function(t,e,i){SCxml.Event.call(this,t),this.srcElement=e||null,this.err=i,e&&"send"==e.tagName&&(this.sendid=e.getAttribute("id"))},SCxml.Error.prototype=new SCxml.Event,SCxml.Error.prototype.constructor=SCxml.Error,SCxml.ExternalEvent=function(t,e,i,n,r){SCxml.Event.call(this,t,"external"),this.origin=e,this.origintype=i,this.invokeid=n,this.data=r},SCxml.ExternalEvent.prototype=new SCxml.Event,SCxml.ExternalEvent.prototype.constructor=SCxml.ExternalEvent,SCxml.ExternalEvent.DOMRefCount=1,SCxml.ExternalEvent.targetOfElement=function(t){return t instanceof Element?'//*[@scxmlref="'+(t.getAttribute("scxmlref")||(t.setAttribute("scxmlref",SCxml.ExternalEvent.DOMRefCount),SCxml.ExternalEvent.DOMRefCount++))+'"]':t},SCxml.ExternalEvent.fromDOMEvent=function(t){var e=new SCxml.ExternalEvent(t.type,SCxml.ExternalEvent.targetOfElement(t.srcElement),SCxml.EventProcessors.DOM.name);if(e.timeStamp=t.timeStamp,t instanceof CustomEvent)e.data=t.detail;else for(var i in t)t.hasOwnProperty(i)&&(e.data[i]=SCxml.ExternalEvent.targetOfElement(t[i]));return e},SCxml.prototype.declare=function(t){var e=t.firstElementChild;if("data"==t.tagName){var i=t.getAttribute("id");i in this.datamodel._jsscxml_predefined_?console.warn("Variable '"+i+"' is shadowing a predefined"+"window variable: please never delete it.\nin",t):this.datamodel[i]=void 0}else for(;e;)this.declare(e),e=e.nextElementSibling},SCxml.prototype.assign=function(t,e){t in this.datamodel._jsscxml_predefined_?this.datamodel._jsscxml_predefined_[t]=e:this.datamodel[t]=e},SCxml.prototype.readParams=function(t,e){for(var i=t.firstElementChild;i;i=i.nextElementSibling)if("param"==i.tagName){var n=i.getAttribute("name"),r=i.getAttribute("expr")||i.getAttribute("loc");try{e.hasOwnProperty(n)?e[n]instanceof Array?e[n].push(this.expr(r,i)):e[n]=[e[n],this.expr(r,i)]:e[n]=this.expr(r,i)}catch(a){throw a}}},SCxml.parseTime=function(t){if(t=/^((?:\d*\.)?\d+)(m?s)$/.exec(t),!t)return-1;var e=Number(t[1]);return"s"==t[2]&&(e*=1e3),e},SCxml.prototype.execute=function(t){if(t.namespaceURI==this.dom.documentElement.namespaceURI){if(t.localName in SCxml.executableContent)return SCxml.executableContent[t.localName](this,t);if(t.localName in SCxml.executableContentNS.tolerate)return console.warn("executable element <"+t.tagName+"> should not use default namespace"),SCxml.executableContentNS.tolerate[t.localName](this,t);for(var e=t.firstElementChild;e;)this.execute(e),e=e.nextElementSibling}else if(t.namespaceURI in SCxml.executableContentNS){if(t.localName in SCxml.executableContentNS[t.namespaceURI])return SCxml.executableContentNS[t.namespaceURI][t.localName](this,t);console.warn("executable element <"+t.tagName+"> is not defined in namespace "+t.namespaceURI)}else{if(t.localName in SCxml.executableContentNS.tolerate)return console.warn("executable element <"+t.tagName+"> should use its own namespace"),SCxml.executableContentNS.tolerate[t.localName](this,t);console.warn("missing executable content extension for namespace "+t.namespaceURI+" used with element <"+t.tagName+">")}},SCxml.executableContentNS={tolerate:{}},SCxml.executableContent={raise:function(t,e){var i=e.getAttribute("event")||t.expr(e.getAttribute("eventexpr"));i=new SCxml.InternalEvent(i,e),t.html.dispatchEvent(new CustomEvent("queue",{detail:i})),t.internalQueue.push(i)},send:function(t,e){if(!t.sendNoMore){var i=e.getAttribute("target")||t.expr(e.getAttribute("targetexpr"),e),n=e.getAttribute("event")||t.expr(e.getAttribute("eventexpr"),e);e.hasAttribute("id")||e.setAttribute("id",t.uniqId());var r=e.getAttribute("id"),a;(a=e.getAttribute("idlocation"))&&t.expr(a+'="'+r+'"');var s=e.getAttribute("type")||t.expr(e.getAttribute("typeexpr"),e)||"SCXML",o=SCxml.parseTime(e.getAttribute("delay")||t.expr(e.getAttribute("delayexpr"),e));if("#_internal"==i){var l=new SCxml.InternalEvent(n,e);return t.html.dispatchEvent(new CustomEvent("queue",{detail:l})),t.internalQueue.push(l),void 0}if(s in SCxml.EventProcessors)s=SCxml.EventProcessors[s];else for(var h in SCxml.EventProcessors)SCxml.EventProcessors[h].name==s&&(s=SCxml.EventProcessors[h]);"object"!=typeof s&&t.error("execution",e,new Error('unsupported IO processor "'+s+'"'));var d=e.getAttribute("namelist"),c={};if(d){d=d.split(" ");for(var m=0,u;u=d[m];m++)c[u]=t.expr(u)}t.readParams(e,c);var p=e.firstElementChild;p&&"content"==p.tagName&&(c=p.textContent);var l=s.createEvent(n,t,c,e);o>-1?(e.sent||(e.sent=[])).push(window.setTimeout(s.send,o,l,i,e,t)):s.send(l,i,e,t)}},cancel:function(t,e){for(var i=e.getAttribute("sendid")||t.expr(e.getAttribute("sendidexpr")),n,r=t.dom.querySelector("send[id="+i+"]").sent;n=r.pop();)try{window.clearTimeout(n)}catch(a){}},log:function(t,e){var i=e.getAttribute("expr");t.log(e.getAttribute("label")+" = "+t.expr(i,e))},data:function(t,e){var i=e.getAttribute("expr"),n=e.getAttribute("id");n in t.datamodel._jsscxml_predefined_?console.warn("Variable '"+n+"' is shadowing a predefined"+"window variable: please never delete it.\nin",e):t.datamodel[n]=void 0,e.hasAttribute("expr")?t.expr(n+" = "+i,e):i=e.getAttribute("src")},assign:function(t,e){var i=e.getAttribute("expr"),n=e.getAttribute("location");n||t.error("syntax",e,new Error("'loc' attribute required")),i=t.expr(n+" = "+i,e),t.expr(n,e)!=i&&t.error("execution",e,new Error("cannot assign to read-only property"))},"if":function(t,e){for(var i=t.expr(e.getAttribute("cond")),n=e.firstElementChild;!i&&n;)"else"==n.tagName&&(i=!0),"elseif"==n.tagName&&(i=t.expr(n.getAttribute("cond"))),n=n.nextElementSibling;for(;n&&"else"!=n.tagName&&"elseif"!=n.tagName;)t.execute(n),n=n.nextElementSibling},foreach:function(t,e){var i=t.expr(e.getAttribute("array")),n=e.getAttribute("item"),r=e.getAttribute("index");"object"!=typeof i&&"string"!=typeof i&&t.error("execution",e,new TypeError("Invalid array")),r&&!/^(\$|[^\W\d])[\w$]*$/.test(r)&&t.error("execution",e,new SyntaxError("Invalid index")),n&&!/^(\$|[^\W\d])[\w$]*$/.test(n)&&t.error("execution",e,new SyntaxError("Invalid item"));for(var a in i){r&&t.assign(r,a),n&&t.assign(n,i[a]);for(var s=e.firstElementChild;s;s=s.nextElementSibling)t.execute(s)}},script:function(t,e){t.wrapScript(e.textContent,e)}},SCxml.invokeTypes={scxml:{name:"http://www.w3.org/TR/scxml",instantiate:function(t,e,i,n){var r=new SCxml(t,null,null,!0);return r.iid=i,r.name=i,r.parent=n,r.sharedData=e,r}}},SCxml.prototype.invokeAll=function(){for(var t=this.dom.querySelectorAll("*[active] > invoke"),e=0;t.length>e;e++)try{this.invoke(t[e])}catch(i){throw i}return this.toInvoke.length},SCxml.prototype.cancelInvoke=function(t){if(!(t in this.invoked))return!1;try{this.invoked[t].clean()}catch(e){throw e}},SCxml.prototype.invoke=function(t){var e=getId(t),i;if(!(e in this.invoked||e in this.toInvoke.items)){(i=t.getAttribute("idlocation"))&&this.expr(i+'="'+e+'"');var n=t.getAttribute("type")||this.expr(t.getAttribute("typeexpr"),t)||"scxml";if(!(n in SCxml.invokeTypes)){n=n.replace(/\/$/,"");for(var r in SCxml.invokeTypes)if(SCxml.invokeTypes[r].name==n){n=r;break}}n in SCxml.invokeTypes||this.error("execution",t,new Error('unsupported invoke type "'+n+'"'));var a=t.getAttribute("src")||this.expr(t.getAttribute("srcexpr"),t),s=t.getAttribute("namelist"),o={};if(s){s=s.split(" ");for(var l=0,h;h=s[l];l++)o[h]=this.expr(h)}this.readParams(t,o);var d=this.dom.querySelector("[id='"+e+"'] > content");d&&(a=d.firstElementChild?(new XMLSerializer).serializeToString(d.firstElementChild):d.textContent),this.toInvoke.add(e);var c=SCxml.invokeTypes[n].instantiate(a,o,e,this);c.af=t.hasAttribute("autoforward")}},SCxml.prototype.emptyFinalize=function(t){var e=this.invoked[t.invokeid];if(e.sharedData&&t.data)for(var i in e.sharedData)i in t.data&&this.assign(i,t.data[i])},"http://www.jsscxml.org"in SCxml.executableContentNS||(SCxml.executableContentNS["http://www.jsscxml.org"]={}),{exc:SCxml.executableContentNS["http://www.jsscxml.org"]})exc._support_={xmls:function(t,e){return t instanceof Element||t instanceof Document?(new XMLSerializer).serializeToString(t):(sc.error("execution",e,new TypeError('"xml" type requires a Document or Element.')),void 0)},urls:function(t,e){"object"!=typeof t&&sc.error("execution",e,new TypeError('"url" type requires an object with enumerable properties.'));var i=[];for(k in t)t.hasOwnProperty(k)&&i.push(k+"="+encodeURIComponent(t[k]));return i.join("&")},mime:{json:"application/json",xml:"application/xml",url:"application/x-www-form-urlencoded",text:"text/plain"},Request:function(target,caller,callback,headers,postData){this.target=target,this.callback=callback,this.caller=caller;var xhr=this;with(this.req=new XMLHttpRequest){open(postData?"POST":"GET",target,!0),onload=function(){xhr.caller.fireEvent(new SCxml.ExternalEvent(xhr.callback+".done",xhr.target,"http",null,xhr.req))},onerror=function(t){xhr.bad||xhr.caller.fireEvent(new SCxml.ExternalEvent(xhr.callback+".failed",xhr.target,"http",null,xhr.req))
};for(var h in headers)setRequestHeader(h,headers[h]);try{send(postData||null)}catch(err){this.bad=!0,caller.error("communication."+callback,target,err,!0)}}}},exc._support_.types={json:JSON.stringify,xml:exc._support_.xmls,url:exc._support_.urls,text:String},SCxml.prototype.readHeaders=function(t,e){for(var i=t.firstElementChild;i;i=i.nextElementSibling)if("header"==i.localName){var n=i.getAttribute("name"),r=i.getAttribute("value")||this.expr(i.getAttribute("expr"),i);n&&r&&(e[n]=r)}},exc.fetch=function(t,e){var i=e.getAttribute("target")||t.expr(e.getAttribute("targetexpr"),e),n=e.getAttribute("callback")||t.expr(e.getAttribute("callbackexpr"),e),r=e.getAttribute("type")||e.getAttribute("enctype")||t.expr(e.getAttribute("typeexpr"),e)||t.expr(e.getAttribute("enctypeexpr"),e)||"text",a;r in exc._support_.types&&(a=exc._support_.types[r]),"function"!=typeof a&&t.error("execution",e,new Error('unsupported fetch enctype "'+r+'"'));var s=e.getAttribute("namelist"),o={};if(s){s=s.split(/\s+/);for(var l=0,h;h=s[l];l++)o[h]=t.expr(h)}t.readParams(e,o);var d={"Content-Type":exc._support_.mime[r]};t.readHeaders(e,d);var c=e.firstElementChild;c&&"content"==c.tagName&&(o=c.textContent),new exc._support_.Request(i,t,n,d,a(o))},SCxml.executableContentNS.tolerate.fetch=exc.fetch;